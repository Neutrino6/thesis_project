import os
import subprocess
import shutil


def compile_js_to_wasm(directory, output_directory):
 
    js_files = [f for f in os.listdir(directory) if f.endswith(".js")]
    
    if not js_files:
        print("No JS file in the directory")
        return
        
        
    #create output directory if it doesn't exist    
    if not os.path.exists(output_directory):
        os.makedirs(output_directory)
        
        
    for js_file in js_files:
        js_path = os.path.join(directory, js_file)
        wasm_output = os.path.splitext(js_file)[0] + ".wasm"
        
        
        command = f'./javy build "{js_path}" -o "{os.path.join(output_directory, wasm_output)}"'
        
  
        print(f"Compile {js_file}...")
        subprocess.run(command, shell=True, executable='/bin/bash',  cwd=script_directory)
    
    print("Completed")


#this path
script_directory = os.getcwd()

#input path
source_directory = os.path.join(script_directory, "Javascript")

#output path
output_directory = os.path.join(script_directory, "Wasm")

#compile C to wasm
compile_js_to_wasm(source_directory, output_directory)

